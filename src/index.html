<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <link rel="stylesheet" href="./preview.css" />
        <script src="https://cdn01.boxcdn.net/polyfills/core-js/2.5.3/core.min.js"></script>
        <script src="./preview.js"></script>

        <script>
            function switchVersion() {
                const script = document.createElement('script');
                let src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/#/pdf.min.js';
                let version = document.getElementById('version').value;
                src = src.replace('#', version);
                script.src = src;

                document.head.appendChild(script);

                script.addEventListener('load', function() {
                    const time = window.performance.now();
                    pdfjsLib = window['pdfjs-dist/build/pdf'];
                    window.pdfjsLib.GlobalWorkerOptions.workerSrc =
                        'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/' + version + '/pdf.worker.min.js';
                    window.workerSet = true;
                    loadPreview();
                    console.log(version);
                    console.log(window.performance.now() - time);
                });
            }

            function switchShakaVersion() {
                const script = document.createElement('script');
                let src = 'https://cdnjs.cloudflare.com/ajax/libs/shaka-player/#/shaka-player.compiled.js';
                let version = document.getElementById('shaka-version').value;
                src = src.replace('#', version);
                script.src = src;

                document.head.appendChild(script);

                script.addEventListener('load', function() {
                    loadPreview();
                    console.log('On shaka player version ' + version);
                });
            }
        </script>

        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
                font-family: sans-serif;
            }

            .setters-container {
                display: flex;
                flex-direction: column;
                height: 15vh;
                padding: 20px;
                overflow: auto;
                font-size: 75%;
            }

            .setters-container button,
            .setters-container input,
            select {
                padding: 5px;
            }

            .container {
                flex: 1 1 auto;
                text-align: center;
            }

            .container > input {
                text-align: center;
            }

            .preview-container {
                width: 100vw;
                height: 90vh;
            }

            .primary-setters,
            .secondary-setters {
                display: flex;
            }

            .secondary-setters {
                margin-top: 10px;
            }

            @media only screen and (max-width: 375px) {
                .setters-container {
                    padding: 0;
                }

                .input-display {
                    max-width: 150px;
                    overflow: hidden;
                    white-space: nowrap;
                    text-overflow: ellipsis;
                }
            }
        </style>
    </head>

    <body>
        <div class="setters-container">
            <div class="primary-setters">
                <div class="container" id="token">
                    <div class="input-display">Token: <span id="token-display"></span></div>
                    <input id="token-set" data-testid="token" placeholder="Enter token" />
                    <button onClick="setProperty('token')" data-testid="token-set">Set new token</button>
                </div>

                <div class="container" id="file">
                    <div class="input-display">File ID: <span id="fileid-display"></span></div>
                    <input id="fileid-set" placeholder="Enter file ID" data-testid="fileid" />
                    <button onClick="setProperty('fileid')" data-testid="fileid-set">Set new file ID</button>
                </div>
                <div class="container">
                    <div class="input-display">PDJ JS Version <span id="pdf-version-display"></span></div>
                    <select onchange="switchVersion()" id="version">
                        <option>
                            3.6.172
                        </option>
                        <option>
                            3.4.120
                        </option>
                        <option>
                            3.2.146
                        </option>
                        <option>
                            3.1.81
                        </option>
                        <option>
                            3.0.279
                        </option>
                        <option>
                            2.16.105
                        </option>
                        <option>
                            2.15.349
                        </option>
                        <option selected>
                            2.14.305
                        </option>
                    </select>
                    <button onclick="loadPreview()">Render File</button>
                </div>

                <div class="container" id="shaka-video-input">
                    <div class="input-display">Shaka Player Version</div>
                    <select id="shaka-version" onchange="switchShakaVersion()">
                        <option>
                            4.3.8
                        </option>
                        <option>
                            4.3.7
                        </option>
                        <option>
                            4.3.6
                        </option>
                        <option>
                            4.3.5
                        </option>
                        <option>
                            4.3.4
                        </option>
                        <option>
                            4.3.3
                        </option>
                        <option>
                            4.3.2
                        </option>
                        <option>
                            4.3.1
                        </option>
                        <option>
                            4.3.0
                        </option>
                        <option>
                            4.2.12
                        </option>
                        <option>
                            4.2.11
                        </option>
                        <option>
                            4.2.10
                        </option>
                        <option>
                            4.2.9
                        </option>
                        <option>
                            4.2.8
                        </option>
                        <option>
                            4.2.7
                        </option>
                        <option>
                            4.2.6
                        </option>
                        <option>
                            4.2.5
                        </option>
                        <option>
                            4.2.4
                        </option>
                        <option>
                            4.2.3
                        </option>
                        <option>
                            4.2.2
                        </option>
                        <option>
                            4.2.1
                        </option>
                        <option>
                            4.2.0
                        </option>
                        <option>
                            4.1.7
                        </option>
                        <option>
                            4.1.6
                        </option>
                        <option>
                            4.1.5
                        </option>
                        <option>
                            4.1.4
                        </option>
                        <option>
                            4.1.3
                        </option>
                        <option>
                            4.1.2
                        </option>
                        <option>
                            4.1.1
                        </option>
                        <option>
                            4.1.0
                        </option>
                        <option>
                            4.0.5
                        </option>
                        <option>
                            4.0.4
                        </option>
                        <option>
                            4.0.3
                        </option>
                        <option>
                            4.0.2
                        </option>
                        <option>
                            4.0.1
                        </option>
                        <option>
                            4.0.0
                        </option>
                        <option>
                            3.3.19
                        </option>
                        <option>
                            3.3.18
                        </option>
                        <option>
                            3.3.17
                        </option>
                        <option>
                            3.3.16
                        </option>
                        <option>
                            3.3.15
                        </option>
                        <option>
                            3.3.14
                        </option>
                        <option>
                            3.3.13
                        </option>
                        <option>
                            3.3.12
                        </option>
                        <option>
                            3.3.11
                        </option>
                        <option>
                            3.3.10
                        </option>
                        <option>
                            3.3.9
                        </option>
                        <option>
                            3.3.8
                        </option>
                        <option>
                            3.3.7
                        </option>
                        <option>
                            3.3.6
                        </option>
                        <option>
                            3.3.5
                        </option>
                        <option>
                            3.3.4
                        </option>
                        <option>
                            3.3.3
                        </option>
                        <option>
                            3.3.2
                        </option>
                        <option>
                            3.3.1
                        </option>
                        <option>
                            3.3.0
                        </option>
                        <option>
                            3.2.21
                        </option>
                        <option>
                            3.2.20
                        </option>
                        <option>
                            3.2.19
                        </option>
                        <option>
                            3.2.18
                        </option>
                        <option>
                            3.2.17
                        </option>
                        <option>
                            3.2.16
                        </option>
                        <option>
                            3.2.15
                        </option>
                        <option>
                            3.2.14
                        </option>
                        <option>
                            3.2.13
                        </option>
                        <option>
                            3.2.12
                        </option>
                        <option>
                            3.2.11
                        </option>
                        <option>
                            3.2.10
                        </option>
                        <option>
                            3.2.9
                        </option>
                        <option>
                            3.2.8
                        </option>
                        <option>
                            3.2.7
                        </option>
                        <option>
                            3.2.6
                        </option>
                        <option>
                            3.2.5
                        </option>
                        <option>
                            3.2.4
                        </option>
                        <option>
                            3.2.3
                        </option>
                        <option>
                            3.2.2
                        </option>
                        <option>
                            3.2.1
                        </option>
                        <option>
                            3.2.0
                        </option>
                        <option>
                            3.1.8
                        </option>
                        <option>
                            3.1.7
                        </option>
                        <option>
                            3.1.6
                        </option>
                        <option>
                            3.1.5
                        </option>
                        <option>
                            3.1.4
                        </option>
                        <option>
                            3.1.3
                        </option>
                        <option>
                            3.1.2
                        </option>
                        <option>
                            3.1.1
                        </option>
                        <option>
                            3.1.0
                        </option>
                        <option>
                            3.0.15
                        </option>
                        <option>
                            3.0.14
                        </option>
                        <option>
                            3.0.13
                        </option>
                        <option>
                            3.0.12
                        </option>
                        <option>
                            3.0.11
                        </option>
                        <option>
                            3.0.10
                        </option>
                        <option>
                            3.0.9
                        </option>
                        <option>
                            3.0.8
                        </option>
                        <option>
                            3.0.7
                        </option>
                        <option>
                            3.0.6
                        </option>
                        <option>
                            3.0.5
                        </option>
                        <option>
                            3.0.4
                        </option>
                        <option>
                            3.0.3
                        </option>
                        <option>
                            3.0.2
                        </option>
                        <option>
                            3.0.1
                        </option>
                        <option>
                            3.0.0
                        </option>
                        <option>
                            2.5.23
                        </option>
                        <option>
                            2.5.22
                        </option>
                        <option>
                            2.5.21
                        </option>
                        <option>
                            2.5.20
                        </option>
                        <option>
                            2.5.19
                        </option>
                        <option>
                            2.5.18
                        </option>
                        <option>
                            2.5.17
                        </option>
                        <option>
                            2.5.16
                        </option>
                        <option>
                            2.5.15
                        </option>
                        <option>
                            2.5.14
                        </option>
                        <option>
                            2.5.12
                        </option>
                        <option>
                            2.5.11
                        </option>
                        <option>
                            2.5.10
                        </option>
                        <option>
                            2.5.9
                        </option>
                        <option>
                            2.5.8
                        </option>
                        <option>
                            2.5.6
                        </option>
                        <option>
                            2.5.5
                        </option>
                        <option>
                            2.5.4
                        </option>
                        <option>
                            2.5.3
                        </option>
                        <option>
                            2.5.2
                        </option>
                        <option>
                            2.5.1
                        </option>
                        <option>
                            2.5.0
                        </option>
                        <option>
                            2.5.0-beta3
                        </option>
                        <option>
                            2.5.0-beta2
                        </option>
                        <option>
                            2.5.0-beta
                        </option>
                        <option>
                            2.4.7
                        </option>
                        <option>
                            2.4.6
                        </option>
                        <option>
                            2.4.5
                        </option>
                        <option>
                            2.4.4
                        </option>
                        <option>
                            2.4.3
                        </option>
                        <option>
                            2.4.2
                        </option>
                        <option>
                            2.4.1
                        </option>
                        <option>
                            2.4.0
                        </option>
                        <option>
                            2.3.10
                        </option>
                        <option>
                            2.3.9
                        </option>
                        <option>
                            2.3.8
                        </option>
                        <option>
                            2.3.7
                        </option>
                        <option>
                            2.3.6
                        </option>
                        <option>
                            2.3.5
                        </option>
                        <option>
                            2.3.4
                        </option>
                        <option>
                            2.3.3
                        </option>
                        <option>
                            2.3.2
                        </option>
                        <option>
                            2.3.1
                        </option>
                        <option>
                            2.3.0
                        </option>
                        <option>
                            2.2.10
                        </option>
                        <option>
                            2.2.9
                        </option>
                        <option>
                            2.2.8
                        </option>
                        <option>
                            2.2.7
                        </option>
                        <option>
                            2.2.6
                        </option>
                        <option>
                            2.2.5
                        </option>
                        <option>
                            2.2.4
                        </option>
                        <option>
                            2.2.3
                        </option>
                        <option>
                            2.2.2
                        </option>
                        <option>
                            2.2.1
                        </option>
                        <option>
                            2.2.0
                        </option>
                        <option>
                            2.1.9
                        </option>
                        <option>
                            2.1.8
                        </option>
                        <option>
                            2.1.7
                        </option>
                        <option>
                            2.1.6
                        </option>
                        <option>
                            2.1.5
                        </option>
                        <option>
                            2.1.4
                        </option>
                        <option>
                            2.1.3
                        </option>
                        <option>
                            2.1.2
                        </option>
                        <option>
                            2.1.1
                        </option>
                        <option>
                            2.1.0
                        </option>
                        <option>
                            2.0.8
                        </option>
                        <option>
                            2.0.7
                        </option>
                        <option>
                            2.0.6
                        </option>
                        <option>
                            2.0.5
                        </option>
                        <option>
                            2.0.4
                        </option>
                        <option>
                            2.0.3
                        </option>
                        <option>
                            2.0.2
                        </option>
                        <option>
                            2.0.1
                        </option>
                        <option>
                            2.0.0
                        </option>
                        <option>
                            2.0.0-beta3
                        </option>
                        <option>
                            2.0.0-beta2
                        </option>
                        <option>
                            2.0.0-beta
                        </option>
                        <option>
                            1.6.5
                        </option>
                        <option>
                            1.6.4
                        </option>
                        <option>
                            1.6.3
                        </option>
                        <option>
                            1.6.2
                        </option>
                        <option>
                            1.6.1
                        </option>
                        <option>
                            1.6.0
                        </option>
                        <option>
                            1.5.2
                        </option>
                        <option>
                            1.5.1
                        </option>
                        <option>
                            1.5.0
                        </option>
                        <option>
                            1.4.2
                        </option>
                        <option>
                            1.4.1
                        </option>
                        <option>
                            1.4.0
                        </option>
                        <option>
                            1.3.2
                        </option>
                        <option>
                            1.3.1
                        </option>
                        <option>
                            1.3.0
                        </option>
                        <option>
                            1.2.4
                        </option>
                        <option>
                            1.2.3
                        </option>
                        <option>
                            1.2.2
                        </option>
                        <option>
                            1.2.0
                        </option>
                        <option>
                            1.1.0
                        </option>
                    </select>
                </div>
                <div class="container" id="load">
                    <button onClick="loadPreview()" data-testid="load-preview">Load Preview</button>
                </div>
            </div>

            <div class="secondary-setters">
                <div class="container" id="collection">
                    <div class="input-display">Collection: <span id="collection-display"></span></div>
                    <input id="collection-set" data-testid="collection" placeholder="Enter list of file ids" />
                    <button onClick="setProperty('collection')" data-testid="collection-set">Set new collection</button>
                    <button onClick="clearProperty('collection')" data-testid="collection-clear">Clear</button>
                    <div>Enter 2+ comma separated list of file ids</div>
                </div>
            </div>
        </div>

        <div class="preview-container" data-testid="preview-container"></div>
        <script>
            // Create preview first so events can be bound before 'show'
            /* global Box */
            preview = new Box.Preview();
            preview.addListener('load', () => {
                window.workerSet = false;
            });

            function clearProperty(selector) {
                var inputEl = document.getElementById(selector + '-set');
                var displayEl = document.getElementById(selector + '-display');
                inputEl.value = '';
                displayEl.textContent = '';
                localStorage.setItem(selector, '');
            }

            function setProperty(selector) {
                // Get new value, fallback to local storage
                var inputValue = document.querySelector('#' + selector + '-set');
                value = (inputValue && inputValue.value) || localStorage.getItem(selector);

                if (!value) {
                    return;
                }

                // Set it for display purposes
                var displayElement = document.querySelector('#' + selector + '-display');
                displayElement.textContent = value;

                // Cache it in local storage
                localStorage.setItem(selector, value);
            }

            function loadPreview(options) {
                var token = localStorage.getItem('token');
                var fileid = localStorage.getItem('fileid');
                var fileidList = localStorage.getItem('collection') || '';

                if (!token || !fileid) {
                    return;
                }

                var collection =
                    fileidList &&
                    fileidList.split(',').map(function(fileid) {
                        return fileid.trim();
                    });

                var previewOptions = options || {
                    collection,
                    enableThumbnailsSidebar: true,
                    showAnnotations: true,
                    showDownload: true,
                };
                previewOptions.container = '.preview-container';

                preview.show(fileid, token, previewOptions);
            }

            // Try to load all properties from storage on page load
            setProperty('token');
            setProperty('fileid');
            setProperty('collection');
            loadPreview();
        </script>
    </body>
</html>
